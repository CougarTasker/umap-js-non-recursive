!function(t){var r={};function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var i in t)e.d(n,i,function(r){return t[r]}.bind(null,i));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=5)}([function(t,r,e){"use strict";const n=Object.prototype.toString;t.exports=function(t){return n.call(t).endsWith("Array]")}},function(t,r,e){"use strict";var n=this&&this.__values||function(t){var r="function"==typeof Symbol&&t[Symbol.iterator],e=0;return r?r.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}};function i(t,r){return void 0===r&&(r=Math.random),Math.floor(r()*t)}function o(t){return void 0===t&&(t=Math.random),t()}function s(t){for(var r=[],e=0;e<t;e++)r.push(void 0);return r}function a(t,r){return s(t).map(function(){return r})}function h(t){return a(t,0)}function u(t){return t.reduce(function(t,r){return t+r})}Object.defineProperty(r,"__esModule",{value:!0}),r.randomNormal2d=function(t,r,e,n){return void 0===t&&(t=0),void 0===r&&(r=1),void 0===e&&(e=[1,1]),void 0===n&&(n=Math.random),Array(e[0]).fill(0).map(function(){return Array(e[1]).fill(0).map(function(){return function(t,r,e){void 0===e&&(e=Math.random);var n=o(e),i=o(e);return Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*i)*r+t}(t,r,n)})})},r.tauRandInt=i,r.tauRand=o,r.norm=function(t){var r,e,i=0;try{for(var o=n(t),s=o.next();!s.done;s=o.next()){var a=s.value;i+=Math.pow(a,2)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(r)throw r.error}}return Math.sqrt(i)},r.empty=s,r.range=function(t){return s(t).map(function(t,r){return r})},r.filled=a,r.zeros=h,r.ones=function(t){return a(t,1)},r.linear=function(t,r,e){return s(e).map(function(n,i){return t+i*((r-t)/(e-1))})},r.sum=u,r.mean=function(t){return u(t)/t.length},r.max=function(t){for(var r=0,e=0;e<t.length;e++)r=t[e]>r?t[e]:r;return r},r.max2d=function(t){for(var r=0,e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)r=t[e][n]>r?t[e][n]:r;return r},r.rejectionSample=function(t,r){for(var e=h(t),n=0;n<t;n++)for(var o=!0;o;){for(var s=i(r),a=!1,u=0;u<n;u++)if(s===e[u]){a=!0;break}a||(o=!1),e[n]=s}return e},r.reshape2d=function(t,r,e){var n=[],i=0;if(t.length!==r*e)throw new Error("Array dimensions must match input length.");for(var o=0;o<r;o++){for(var s=[],a=0;a<e;a++)s.push(t[i]),i+=1;n.push(s)}return n}},function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e(1);function i(t,r){var e=function(e){return n.empty(t).map(function(){return n.filled(r,e)})},i=[];return i.push(e(-1)),i.push(e(1/0)),i.push(e(0)),i}function o(t,r,e,n,i){r=Math.floor(r);var o=t[0][r],a=t[1][r];t[2][r];if(e>=a[0])return 0;for(var h=0;h<o.length;h++)if(n===o[h])return 0;return s(t,r,e,n,i)}function s(t,r,e,n,i){var o=t[0][r],s=t[1][r],a=t[2][r];if(e>=s[0])return 0;s[0]=e,o[0]=n,a[0]=i;for(var h=0,u=0;;){var l=2*h+1,c=l+1,f=t[0][0].length;if(l>=f)break;if(c>=f){if(!(s[l]>e))break;u=l}else if(s[l]>=s[c]){if(!(e<s[l]))break;u=l}else{if(!(e<s[c]))break;u=c}s[h]=s[u],o[h]=o[u],a[h]=a[u],h=u}return s[h]=e,o[h]=n,a[h]=i,1}function a(t,r,e,n){for(;2*n+1<e;){var i=2*n+1,o=i+1,s=n;if(t[s]<t[i]&&(s=i),o<e&&t[s]<t[o]&&(s=o),s===n)break;var a=t[n];t[n]=t[s],t[s]=a;var h=r[n];r[n]=r[s],r[s]=h,n=s}}r.makeHeap=i,r.rejectionSample=function(t,r,e){for(var i=n.zeros(t),o=0;o<t;o++){for(var s=!0,a=0;s;){a=n.tauRandInt(r,e);for(var h=!1,u=0;u<o;u++)if(a===i[u]){h=!0;break}h||(s=!1)}i[o]=a}return i},r.heapPush=o,r.uncheckedHeapPush=s,r.buildCandidates=function(t,r,e,s,a){for(var h=i(r,s),u=0;u<r;u++)for(var l=0;l<e;l++)if(!(t[0][u][l]<0)){var c=t[0][u][l],f=t[2][u][l],m=n.tauRand(a);o(h,u,m,c,f),o(h,c,m,u,f),t[2][u][l]=0}return h},r.deheapSort=function(t){for(var r=t[0],e=t[1],n=0;n<r.length;n++)for(var i=r[n],o=e[n],s=0;s<i.length-1;s++){var h=i.length-s-1,u=o.length-s-1,l=i[0];i[0]=i[h],i[h]=l;var c=o[0];o[0]=o[u],o[u]=c,a(o,i,u,0)}return{indices:r,weights:e}},r.smallestFlagged=function(t,r){for(var e=t[0][r],n=t[1][r],i=t[2][r],o=1/0,s=-1,a=0;a>e.length;a++)1===i[a]&&n[a]<o&&(o=n[a],s=a);return s>=0?(i[s]=0,Math.floor(e[s])):-1}},function(t,r,e){"use strict";var n,i=this&&this.__read||function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var n,i,o=e.call(t),s=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__spread||function(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(i(arguments[r]));return t},s=this&&this.__values||function(t){var r="function"==typeof Symbol&&t[Symbol.iterator],e=0;return r?r.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}};Object.defineProperty(r,"__esModule",{value:!0});var a=e(1),h=function(){function t(t,r,e,n){this.entries=new Map,this.nRows=0,this.nCols=0,this.rows=o(t),this.cols=o(r),this.values=o(e);for(var i=0;i<e.length;i++){var s=this.makeKey(this.rows[i],this.cols[i]);this.entries.set(s,i)}this.nRows=n[0],this.nCols=n[1]}return t.prototype.makeKey=function(t,r){return t+":"+r},t.prototype.checkDims=function(t,r){if(!(t<this.nRows&&r<this.nCols))throw new Error("array index out of bounds")},t.prototype.set=function(t,r,e){this.checkDims(t,r);var n=this.makeKey(t,r);if(this.entries.has(n)){var i=this.entries.get(n);this.values[i]=e}else this.rows.push(t),this.cols.push(r),this.values.push(e),this.entries.set(n,this.values.length-1)},t.prototype.get=function(t,r,e){void 0===e&&(e=0),this.checkDims(t,r);var n=this.makeKey(t,r);if(this.entries.has(n)){var i=this.entries.get(n);return this.values[i]}return e},t.prototype.getDims=function(){return[this.nRows,this.nCols]},t.prototype.getRows=function(){return o(this.rows)},t.prototype.getCols=function(){return o(this.cols)},t.prototype.getValues=function(){return o(this.values)},t.prototype.forEach=function(t){for(var r=0;r<this.values.length;r++)t(this.values[r],this.rows[r],this.cols[r])},t.prototype.map=function(r){for(var e=[],n=0;n<this.values.length;n++)e.push(r(this.values[n],this.rows[n],this.cols[n]));var i=[this.nRows,this.nCols];return new t(this.rows,this.cols,e,i)},t.prototype.toArray=function(){for(var t=this,r=a.empty(this.nRows).map(function(){return a.zeros(t.nCols)}),e=0;e<this.values.length;e++)r[this.rows[e]][this.cols[e]]=this.values[e];return r},t}();r.SparseMatrix=h,r.transpose=function(t){var r=[],e=[],n=[];t.forEach(function(t,i,o){r.push(i),e.push(o),n.push(t)});var i=[t.nCols,t.nRows];return new h(e,r,n,i)},r.identity=function(t){for(var r=i(t,1)[0],e=new h([],[],[],t),n=0;n<r;n++)e.set(n,n,1);return e},r.pairwiseMultiply=function(t,r){return l(t,r,function(t,r){return t*r})},r.add=function(t,r){return l(t,r,function(t,r){return t+r})},r.subtract=function(t,r){return l(t,r,function(t,r){return t-r})},r.maximum=function(t,r){return l(t,r,function(t,r){return t>r?t:r})},r.multiplyScalar=function(t,r){return t.map(function(t){return t*r})},r.eliminateZeros=function(t){for(var r=new Set,e=t.getValues(),n=t.getRows(),i=t.getCols(),o=0;o<e.length;o++)0===e[o]&&r.add(o);var s=function(t,e){return!r.has(e)},a=e.filter(s),u=n.filter(s),l=i.filter(s);return new h(u,l,a,t.getDims())},r.normalize=function(t,r){var e,n;void 0===r&&(r="l2");var i=u[r],o=new Map;t.forEach(function(t,r,e){var n=o.get(r)||[];n.push(e),o.set(r,n)});var a=new h([],[],[],t.getDims()),l=function(r){for(var e=o.get(r).sort(),n=e.map(function(e){return t.get(r,e)}),s=i(n),h=0;h<s.length;h++)a.set(r,e[h],s[h])};try{for(var c=s(o.keys()),f=c.next();!f.done;f=c.next())l(f.value)}catch(t){e={error:t}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}return a};var u=((n={}).max=function(t){for(var r=-1/0,e=0;e<t.length;e++)r=t[e]>r?t[e]:r;return t.map(function(t){return t/r})},n.l1=function(t){for(var r=0,e=0;e<t.length;e++)r+=t[e];return t.map(function(t){return t/r})},n.l2=function(t){for(var r=0,e=0;e<t.length;e++)r+=Math.pow(t[e],2);return t.map(function(t){return Math.sqrt(Math.pow(t,2)/r)})},n);function l(t,r,e){for(var n=new Set,i=[],o=[],s=[],a=function(n,a){i.push(n),o.push(a);var h=e(t.get(n,a),r.get(n,a));s.push(h)},u=t.getValues(),l=t.getRows(),c=t.getCols(),f=0;f<u.length;f++){var m=(d=l[f])+":"+(w=c[f]);n.add(m),a(d,w)}var g=r.getValues(),p=r.getRows(),v=r.getCols();for(f=0;f<g.length;f++){var d,w;m=(d=p[f])+":"+(w=v[f]);n.has(m)||a(d,w)}var y=[t.nRows,t.nCols];return new h(i,o,s,y)}r.getCSR=function(t){var r=[];t.forEach(function(t,e,n){r.push({value:t,row:e,col:n})}),r.sort(function(t,r){return t.row===r.row?t.col-r.col:t.row-r.col});for(var e=[],n=[],i=[],o=-1,s=0;s<r.length;s++){var a=r[s],h=a.row,u=a.col,l=a.value;h!==o&&(o=h,i.push(s)),e.push(u),n.push(l)}return{indices:e,values:n,indptr:i}}},function(t,r,e){"use strict";var n=this&&this.__read||function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var n,i,o=e.call(t),s=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(n(arguments[r]));return t},o=this&&this.__values||function(t){var r="function"==typeof Symbol&&t[Symbol.iterator],e=0;return r?r.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}};Object.defineProperty(r,"__esModule",{value:!0});var s=e(1),a=function(){return function(t,r,e,n){this.hyperplanes=t,this.offsets=r,this.children=e,this.indices=n}}();function h(t,r,e){for(var n=r,i=0;i<e.length;i++)n+=t[i]*e[i];return 0===n?s.tauRandInt(2):n>0?0:1}r.FlatTree=a,r.makeForest=function(t,r,e,n){var o=Math.max(10,r);return s.range(e).map(function(r,e){return function(t,r,e,n){void 0===r&&(r=30);var i=s.range(t.length);return function t(r,e,n,i,o){if(void 0===n&&(n=30),e.length>n){var a=function(t,r,e){var n=t[0].length,i=s.tauRandInt(r.length,e),o=s.tauRandInt(r.length,e);o=(o+=i===o?1:0)%r.length;for(var a=r[i],h=r[o],u=0,l=s.zeros(n),c=0;c<l.length;c++)l[c]=t[a][c]-t[h][c],u-=l[c]*(t[a][c]+t[h][c])/2;for(var f=0,m=0,g=s.zeros(r.length),c=0;c<r.length;c++){for(var p=u,v=0;v<n;v++)p+=l[v]*t[r[c]][v];0===p?(g[c]=s.tauRandInt(2,e),0===g[c]?f+=1:m+=1):p>0?(g[c]=0,f+=1):(g[c]=1,m+=1)}var d=s.zeros(f),w=s.zeros(m);for(var c in f=0,m=0,s.range(g.length))0===g[c]?(d[f]=r[c],f+=1):(w[m]=r[c],m+=1);return{indicesLeft:d,indicesRight:w,hyperplane:l,offset:u}}(r,e,o),h=a.indicesLeft,u=a.indicesRight,l=a.hyperplane,c=a.offset,f=t(r,h,n,i+1,o),m=t(r,u,n,i+1,o),g={leftChild:f,rightChild:m,isLeaf:!1,hyperplane:l,offset:c};return g}var g={indices:e,isLeaf:!0};return g}(t,i,r,e,n)}(t,o,e,n)}).map(function(t){return function(t,r){var e=function t(r){return r.isLeaf?1:1+t(r.leftChild)+t(r.rightChild)}(t),n=function t(r){return r.isLeaf?1:t(r.leftChild)+t(r.rightChild)}(t),o=s.range(e).map(function(){return s.zeros(t.hyperplane.length)}),h=s.zeros(e),u=s.range(e).map(function(){return[-1,-1]}),l=s.range(n).map(function(){return s.range(r).map(function(){return-1})});return function t(r,e,n,o,s,a,h){var u;if(r.isLeaf)return o[a][0]=-h,(u=s[h]).splice.apply(u,i([0,r.indices.length],r.indices)),{nodeNum:a,leafNum:h+=1};e[a]=r.hyperplane,n[a]=r.offset,o[a][0]=a+1;var l=a,c=t(r.leftChild,e,n,o,s,a+1,h);return a=c.nodeNum,h=c.leafNum,o[l][1]=a+1,{nodeNum:(c=t(r.rightChild,e,n,o,s,a+1,h)).nodeNum,leafNum:c.leafNum}}(t,o,h,u,l,0,0),new a(o,h,u,l)}(t,o)})},r.makeLeafArray=function(t){var r,e;if(t.length>0){var n=[];try{for(var s=o(t),a=s.next();!a.done;a=s.next()){var h=a.value;n.push.apply(n,i(h.indices))}}catch(t){r={error:t}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(r)throw r.error}}return n}return[[-1]]},r.searchFlatTree=function(t,r){for(var e=0;r.children[e][0]>0;)e=0===h(r.hyperplanes[e],r.offsets[e],t)?r.children[e][0]:r.children[e][1];var n=-1*r.children[e][0];return r.indices[n]}},function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e(6);window.UMAP=n.UMAP},function(t,r,e){"use strict";var n=this&&this.__awaiter||function(t,r,e,n){return new(e||(e=Promise))(function(i,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function a(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){t.done?i(t.value):new e(function(r){r(t.value)}).then(s,a)}h((n=n.apply(t,r||[])).next())})},i=this&&this.__generator||function(t,r){var e,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=r.call(t,s)}catch(t){o=[6,t],n=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__read||function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var n,i,o=e.call(t),s=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(i)throw i.error}}return s},s=this&&this.__spread||function(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(o(arguments[r]));return t};Object.defineProperty(r,"__esModule",{value:!0});var a=e(2),h=e(3),u=e(7),l=e(4),c=e(1),f=e(8),m=function(){function t(t){var r=this;void 0===t&&(t={}),this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=g,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new p;var e=function(e){void 0!==t[e]&&(r[e]=t[e])};e("learningRate"),e("localConnectivity"),e("minDist"),e("nComponents"),e("nEpochs"),e("nNeighbors"),e("negativeSampleRate"),e("random"),e("repulsionStrength"),e("setOpMixRatio"),e("spread"),e("transformQueueSize")}return t.prototype.fit=function(t){return this.initializeFit(t),this.optimizeLayout(),this.embedding},t.prototype.fitAsync=function(t,r){return void 0===r&&(r=function(){return!0}),n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this.initializeFit(t),[4,this.optimizeLayoutAsync(r)];case 1:return e.sent(),[2,this.embedding]}})})},t.prototype.setSupervisedProjection=function(t,r){void 0===r&&(r={}),this.Y=t,this.targetMetric=r.targetMetric||this.targetMetric,this.targetWeight=r.targetWeight||this.targetWeight,this.targetNNeighbors=r.targetNNeighbors||this.targetNNeighbors},t.prototype.setPrecomputedKNN=function(t,r){this.knnIndices=t,this.knnDistances=r},t.prototype.initializeFit=function(t){if(this.X===t&&this.isInitialized)return this.getNEpochs();if(this.X=t,!this.knnIndices&&!this.knnDistances){var r=this.nearestNeighbors(t);this.knnIndices=r.knnIndices,this.knnDistances=r.knnDistances}this.graph=this.fuzzySimplicialSet(t,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(t),this.processGraphForSupervisedProjection();var e=this.initializeSimplicialSetEmbedding(),n=e.head,i=e.tail,o=e.epochsPerSample;return this.optimizationState.head=n,this.optimizationState.tail=i,this.optimizationState.epochsPerSample=o,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},t.prototype.makeSearchFns=function(){var t=u.makeInitializations(this.distanceFn),r=t.initFromTree,e=t.initFromRandom;this.initFromTree=r,this.initFromRandom=e,this.search=u.makeInitializedNNSearch(this.distanceFn)},t.prototype.makeSearchGraph=function(t){for(var r=this.knnIndices,e=this.knnDistances,n=[t.length,t.length],i=new h.SparseMatrix([],[],[],n),o=0;o<r.length;o++)for(var s=r[o],a=e[o],u=0;u<s.length;u++){var l=s[u],c=a[u];c>0&&i.set(o,l,c)}var f=h.transpose(i);return h.maximum(i,f)},t.prototype.transform=function(t){var r=this,e=this.X;if(void 0===e||0===e.length)throw new Error("No data has been fit.");var n=Math.floor(this.nNeighbors*this.transformQueueSize),i=u.initializeSearch(this.rpForest,e,t,n,this.initFromRandom,this.initFromTree),o=this.search(e,this.searchGraph,i,t),s=a.deheapSort(o),l=s.indices,f=s.weights;l=l.map(function(t){return t.slice(0,r.nNeighbors)}),f=f.map(function(t){return t.slice(0,r.nNeighbors)});var m=Math.max(0,this.localConnectivity-1),g=this.smoothKNNDistance(f,this.nNeighbors,m),p=g.sigmas,v=g.rhos,d=this.computeMembershipStrengths(l,f,p,v),w=d.rows,y=d.cols,b=d.vals,M=[t.length,e.length],S=new h.SparseMatrix(w,y,b,M),E=h.normalize(S,"l1"),R=h.getCSR(E),z=t.length,k=x(c.reshape2d(R.indices,z,this.nNeighbors),c.reshape2d(R.values,z,this.nNeighbors),this.embedding),N=this.nEpochs?this.nEpochs/3:S.nRows<=1e4?100:30,A=S.getValues().reduce(function(t,r){return r>t?r:t},0);S=S.map(function(t){return t<A/N?0:t}),S=h.eliminateZeros(S);var C=this.makeEpochsPerSample(S.getValues(),N),V=S.getRows(),I=S.getCols();return this.assignOptimizationStateParameters({headEmbedding:k,tailEmbedding:this.embedding,head:V,tail:I,currentEpoch:0,nEpochs:N,nVertices:S.getDims()[1],epochsPerSample:C}),this.prepareForOptimizationLoop(),this.optimizeLayout()},t.prototype.processGraphForSupervisedProjection=function(){var t=this.Y,r=this.X;if(t){if(t.length!==r.length)throw new Error("Length of X and y must be equal");if("categorical"===this.targetMetric){var e=this.targetWeight<1?1/(1-this.targetWeight)*2.5:1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,t,e)}}},t.prototype.step=function(){var t=this.optimizationState.currentEpoch;return t<this.getNEpochs()&&this.optimizeLayoutStep(t),this.optimizationState.currentEpoch},t.prototype.getEmbedding=function(){return this.embedding},t.prototype.nearestNeighbors=function(t){var r,e=this.distanceFn,n=this.nNeighbors,i=u.makeNNDescent(e,this.random),o=5+Math.floor(.5===(r=Math.pow(t.length,.5)/20)?0:Math.round(r)),s=Math.max(5,Math.floor(Math.round(function(t){return Math.log(t)/Math.log(2)}(t.length))));this.rpForest=l.makeForest(t,n,o,this.random);var a=i(t,l.makeLeafArray(this.rpForest),n,s);return{knnIndices:a.indices,knnDistances:a.weights}},t.prototype.fuzzySimplicialSet=function(t,r,e){void 0===e&&(e=1);var n=this.knnIndices,i=void 0===n?[]:n,o=this.knnDistances,s=void 0===o?[]:o,a=this.localConnectivity,u=this.smoothKNNDistance(s,r,a),l=u.sigmas,c=u.rhos,f=this.computeMembershipStrengths(i,s,l,c),m=f.rows,g=f.cols,p=f.vals,v=[t.length,t.length],d=new h.SparseMatrix(m,g,p,v),w=h.transpose(d),y=h.pairwiseMultiply(d,w),b=h.subtract(h.add(d,w),y),x=h.multiplyScalar(b,e),M=h.multiplyScalar(y,1-e);return h.add(x,M)},t.prototype.categoricalSimplicialSetIntersection=function(t,r,e,n){void 0===n&&(n=1);var i=y(t,r,n,e);return b(i=h.eliminateZeros(i))},t.prototype.smoothKNNDistance=function(t,r,e,n,i){void 0===e&&(e=1),void 0===n&&(n=64),void 0===i&&(i=1);for(var o=Math.log(r)/Math.log(2)*i,s=c.zeros(t.length),a=c.zeros(t.length),h=0;h<t.length;h++){var u=0,l=1/0,f=1,m=t[h],g=m.filter(function(t){return t>0});if(g.length>=e){var p=Math.floor(e),v=e-p;p>0?(s[h]=g[p-1],v>1e-5&&(s[h]+=v*(g[p]-g[p-1]))):s[h]=v*g[0]}else g.length>0&&(s[h]=c.max(g));for(var d=0;d<n;d++){for(var w=0,y=1;y<t[h].length;y++){var b=t[h][y]-s[h];w+=b>0?Math.exp(-b/f):1}if(Math.abs(w-o)<1e-5)break;w>o?f=(u+(l=f))/2:(u=f,l===1/0?f*=2:f=(u+l)/2)}if(a[h]=f,s[h]>0){var x=c.mean(m);a[h]<.001*x&&(a[h]=.001*x)}else{var M=c.mean(t.map(c.mean));a[h]<.001*M&&(a[h]=.001*M)}}return{sigmas:a,rhos:s}},t.prototype.computeMembershipStrengths=function(t,r,e,n){for(var i=t.length,o=t[0].length,s=c.zeros(i*o),a=c.zeros(i*o),h=c.zeros(i*o),u=0;u<i;u++)for(var l=0;l<o;l++){var f=0;-1!==t[u][l]&&(f=t[u][l]===u?0:r[u][l]-n[u]<=0?1:Math.exp(-(r[u][l]-n[u])/e[u]),s[u*o+l]=u,a[u*o+l]=t[u][l],h[u*o+l]=f)}return{rows:s,cols:a,vals:h}},t.prototype.initializeSimplicialSetEmbedding=function(){for(var t=this,r=this.getNEpochs(),e=this.nComponents,n=this.graph.getValues(),i=0,o=0;o<n.length;o++){var s=n[o];i<n[o]&&(i=s)}var a=this.graph.map(function(t){return t<i/r?0:t});this.embedding=c.zeros(a.nRows).map(function(){return c.zeros(e).map(function(){return 20*c.tauRand(t.random)-10})});var h=[],u=[],l=[];for(o=0;o<a.nRows;o++)for(var f=0;f<a.nCols;f++){(s=a.get(o,f))&&(h.push(s),l.push(o),u.push(f))}return{head:u,tail:l,epochsPerSample:this.makeEpochsPerSample(h,r)}},t.prototype.makeEpochsPerSample=function(t,r){var e=c.filled(t.length,-1),n=c.max(t),i=t.map(function(t){return t/n*r});return i.forEach(function(t,n){t>0&&(e[n]=r/i[n])}),e},t.prototype.assignOptimizationStateParameters=function(t){Object.assign(this.optimizationState,t)},t.prototype.prepareForOptimizationLoop=function(){var t=this.repulsionStrength,r=this.learningRate,e=this.negativeSampleRate,n=this.optimizationState,i=n.epochsPerSample,o=n.headEmbedding,a=n.tailEmbedding,h=o[0].length,u=o.length===a.length,l=i.map(function(t){return t/e}),c=s(l),f=s(i);this.assignOptimizationStateParameters({epochOfNextSample:f,epochOfNextNegativeSample:c,epochsPerNegativeSample:l,moveOther:u,initialAlpha:r,alpha:r,gamma:t,dim:h})},t.prototype.initializeOptimization=function(){var t=this.embedding,r=this.embedding,e=this.optimizationState,n=e.head,i=e.tail,o=e.epochsPerSample,s=this.getNEpochs(),a=this.graph.nCols,h=w(this.spread,this.minDist),u=h.a,l=h.b;this.assignOptimizationStateParameters({headEmbedding:t,tailEmbedding:r,head:n,tail:i,epochsPerSample:o,a:u,b:l,nEpochs:s,nVertices:a})},t.prototype.optimizeLayoutStep=function(t){for(var r=this.optimizationState,e=r.head,n=r.tail,i=r.headEmbedding,o=r.tailEmbedding,s=r.epochsPerSample,a=r.epochOfNextSample,h=r.epochOfNextNegativeSample,u=r.epochsPerNegativeSample,l=r.moveOther,f=r.initialAlpha,m=r.alpha,g=r.gamma,p=r.a,w=r.b,y=r.dim,b=r.nEpochs,x=r.nVertices,M=0;M<s.length;M++)if(!(a[M]>t)){var S=e[M],E=n[M],R=i[S],z=o[E],k=d(R,z),N=0;k>0&&(N=-2*p*w*Math.pow(k,w-1),N/=p*Math.pow(k,w)+1);for(var A=0;A<y;A++){var C=v(N*(R[A]-z[A]),4);R[A]+=C*m,l&&(z[A]+=-C*m)}a[M]+=s[M];for(var V=Math.floor((t-h[M])/u[M]),I=0;I<V;I++){var P=c.tauRandInt(x,this.random),j=o[P],_=d(R,j),F=0;if(_>0)F=2*g*w,F/=(.001+_)*(p*Math.pow(_,w)+1);else if(S===P)continue;for(A=0;A<y;A++){C=4;F>0&&(C=v(F*(R[A]-j[A]),4)),R[A]+=C*m}}h[M]+=V*u[M]}return r.alpha=f*(1-t/b),r.currentEpoch+=1,i},t.prototype.optimizeLayoutAsync=function(t){var r=this;return void 0===t&&(t=function(){return!0}),new Promise(function(e,o){var s=function(){return n(r,void 0,void 0,function(){var r,n,a,h,u,l;return i(this,function(i){try{if(r=this.optimizationState,n=r.nEpochs,a=r.currentEpoch,this.embedding=this.optimizeLayoutStep(a),h=this.optimizationState.currentEpoch,u=!1===t(h),l=h===n,u||l)return[2,e(l)];s()}catch(t){o(t)}return[2]})})};s()})},t.prototype.optimizeLayout=function(t){void 0===t&&(t=function(){return!0});for(var r=!1,e=[];!r;){var n=this.optimizationState,i=n.nEpochs,o=n.currentEpoch;e=this.optimizeLayoutStep(o);var s=this.optimizationState.currentEpoch,a=!1===t(s);r=s===i||a}return e},t.prototype.getNEpochs=function(){var t=this.graph;if(this.nEpochs>0)return this.nEpochs;var r=t.nRows;return r<=2500?500:r<=5e3?400:r<=7500?300:200},t}();function g(t,r){for(var e=0,n=0;n<t.length;n++)e+=Math.pow(t[n]-r[n],2);return Math.sqrt(e)}r.UMAP=m,r.euclidean=g,r.cosine=function(t,r){for(var e=0,n=0,i=0,o=0;o<t.length;o++)e+=t[o]*r[o],n+=Math.pow(t[o],2),i+=Math.pow(r[o],2);return 0===n&&0===i?0:0===n||0===i?1:1-e/Math.sqrt(n*i)};var p=function(){return function(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}}();function v(t,r){return t>r?r:t<-r?-r:t}function d(t,r){for(var e=0,n=0;n<t.length;n++)e+=Math.pow(t[n]-r[n],2);return e}function w(t,r){var e=c.linear(0,3*t,300).map(function(t){return t<r?1:t}),n=c.zeros(e.length).map(function(n,i){return e[i]>=r?Math.exp(-(e[i]-r)/t):n}),i={x:e,y:n},s={damping:1.5,initialValues:[.5,.5],gradientDifference:.1,maxIterations:100,errorTolerance:.01},a=f.default(i,function(t){var r=o(t,2),e=r[0],n=r[1];return function(t){return 1/(1+e*Math.pow(t,2*n))}},s).parameterValues,h=o(a,2);return{a:h[0],b:h[1]}}function y(t,r,e,n){return void 0===e&&(e=1),void 0===n&&(n=5),t.map(function(t,i,o){return-1===r[i]||-1===r[o]?t*Math.exp(-e):r[i]!==r[o]?t*Math.exp(-n):t})}function b(t){t=h.normalize(t,"max");var r=h.transpose(t),e=h.pairwiseMultiply(r,t);return t=h.add(t,h.subtract(r,e)),h.eliminateZeros(t)}function x(t,r,e){for(var n=c.zeros(t.length).map(function(t){return c.zeros(e[0].length)}),i=0;i<t.length;i++)for(var o=0;o<t[0].length;o++)for(var s=0;s<e[0].length;s++){var a=t[i][o];n[i][s]+=r[i][o]*e[a][s]}return n}r.findABParams=w,r.fastIntersection=y,r.resetLocalConnectivity=b,r.initTransform=x},function(t,r,e){"use strict";var n=this&&this.__values||function(t){var r="function"==typeof Symbol&&t[Symbol.iterator],e=0;return r?r.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}};Object.defineProperty(r,"__esModule",{value:!0});var i=e(2),o=e(3),s=e(4),a=e(1);r.makeNNDescent=function(t,r){return function(e,n,o,s,h,u,l,c){void 0===s&&(s=10),void 0===h&&(h=50),void 0===u&&(u=.001),void 0===l&&(l=.5),void 0===c&&(c=!0);for(var f=e.length,m=i.makeHeap(e.length,o),g=0;g<e.length;g++)for(var p=i.rejectionSample(o,e.length,r),v=0;v<p.length;v++){var d=t(e[g],e[p[v]]);i.heapPush(m,g,d,p[v],1),i.heapPush(m,p[v],d,g,1)}if(c)for(var w=0;w<n.length;w++)for(g=0;g<n[w].length&&!(n[w][g]<0);g++)for(v=g+1;v<n[w].length&&!(n[w][v]<0);v++)d=t(e[n[w][g]],e[n[w][v]]),i.heapPush(m,n[w][g],d,n[w][v],1),i.heapPush(m,n[w][v],d,n[w][g],1);for(w=0;w<s;w++){var y=i.buildCandidates(m,f,o,h,r),b=0;for(g=0;g<f;g++)for(v=0;v<h;v++){var x=Math.floor(y[0][g][v]);if(!(x<0||a.tauRand(r)<l))for(var M=0;M<h;M++){var S=Math.floor(y[0][g][M]),E=y[2][g][v],R=y[2][g][M];S<0||!E&&!R||(d=t(e[x],e[S]),b+=i.heapPush(m,x,d,S,1),b+=i.heapPush(m,S,d,x,1))}}if(b<=u*o*e.length)break}return i.deheapSort(m)}},r.makeInitializations=function(t){return{initFromRandom:function(r,e,n,o){for(var s=0;s<n.length;s++)for(var h=a.rejectionSample(r,e.length),u=0;u<h.length;u++)if(!(h[u]<0)){var l=t(e[h[u]],n[s]);i.heapPush(o,s,l,h[u],1)}},initFromTree:function(r,e,n,o){for(var a=0;a<n.length;a++)for(var h=s.searchFlatTree(n[a],r),u=0;u<h.length;u++){if(h[u]<0)return;var l=t(e[h[u]],n[a]);i.heapPush(o,a,l,h[u],1)}}}},r.makeInitializedNNSearch=function(t){return function(r,e,s,a){for(var h,u,l=o.getCSR(e),c=l.indices,f=l.indptr,m=0;m<a.length;m++)for(var g=new Set(s[0][m]);;){var p=i.smallestFlagged(s,m);if(-1===p)break;var v=c.slice(f[p],f[p+1]);try{for(var d=n(v),w=d.next();!w.done;w=d.next()){var y=w.value;if(y!==p&&-1!==y&&!g.has(y)){var b=t(r[y],a[m]);i.uncheckedHeapPush(s,m,b,y,1),g.add(y)}}}catch(t){h={error:t}}finally{try{w&&!w.done&&(u=d.return)&&u.call(d)}finally{if(h)throw h.error}}}return s}},r.initializeSearch=function(t,r,e,o,s,a){var h,u,l=i.makeHeap(e.length,o);if(s(o,r,e,l),t)try{for(var c=n(t),f=c.next();!f.done;f=c.next())a(f.value,r,e,l)}catch(t){h={error:t}}finally{try{f&&!f.done&&(u=c.return)&&u.call(c)}finally{if(h)throw h.error}}return l}},function(t,r,e){"use strict";function n(t,r,e){var n=0;const i=e(r);for(var o=0;o<t.x.length;o++)n+=Math.abs(t.y[o]-i(t.x[o]));return n}e.r(r);var i=e(0),o=e.n(i);var s=function(t){if(!o()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var r=t[0],e=1;e<t.length;e++)t[e]>r&&(r=t[e]);return r};var a=function(t){if(!o()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var r=t[0],e=1;e<t.length;e++)t[e]<r&&(r=t[e]);return r};var h=function(t){var r,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!o()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==e.output){if(!o()(e.output))throw new TypeError("output option must be an array if specified");r=e.output}else r=new Array(t.length);var n=a(t),i=s(t);if(n===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var h=e.min,u=void 0===h?e.autoMinMax?n:0:h,l=e.max,c=void 0===l?e.autoMinMax?i:1:l;if(u>=c)throw new RangeError("min option must be smaller than max option");for(var f=(c-u)/(i-n),m=0;m<t.length;m++)r[m]=(t[m]-n)*f+u;return r};class u{constructor(t){var r,e,n,i,o,s,a,h,u,l=(t=j.checkMatrix(t)).clone(),c=l.rows,f=l.columns,m=new Array(c),g=1;for(r=0;r<c;r++)m[r]=r;for(h=new Array(c),e=0;e<f;e++){for(r=0;r<c;r++)h[r]=l.get(r,e);for(r=0;r<c;r++){for(u=Math.min(r,e),o=0,n=0;n<u;n++)o+=l.get(r,n)*h[n];h[r]-=o,l.set(r,e,h[r])}for(i=e,r=e+1;r<c;r++)Math.abs(h[r])>Math.abs(h[i])&&(i=r);if(i!==e){for(n=0;n<f;n++)s=l.get(i,n),l.set(i,n,l.get(e,n)),l.set(e,n,s);a=m[i],m[i]=m[e],m[e]=a,g=-g}if(e<c&&0!==l.get(e,e))for(r=e+1;r<c;r++)l.set(r,e,l.get(r,e)/l.get(e,e))}this.LU=l,this.pivotVector=m,this.pivotSign=g}isSingular(){for(var t=this.LU,r=t.columns,e=0;e<r;e++)if(0===t[e][e])return!0;return!1}solve(t){t=P.checkMatrix(t);var r=this.LU;if(r.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var e,n,i,o=t.columns,s=t.subMatrixRow(this.pivotVector,0,o-1),a=r.columns;for(i=0;i<a;i++)for(e=i+1;e<a;e++)for(n=0;n<o;n++)s[e][n]-=s[i][n]*r[e][i];for(i=a-1;i>=0;i--){for(n=0;n<o;n++)s[i][n]/=r[i][i];for(e=0;e<i;e++)for(n=0;n<o;n++)s[e][n]-=s[i][n]*r[e][i]}return s}get determinant(){var t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");for(var r=this.pivotSign,e=t.columns,n=0;n<e;n++)r*=t[n][n];return r}get lowerTriangularMatrix(){for(var t=this.LU,r=t.rows,e=t.columns,n=new P(r,e),i=0;i<r;i++)for(var o=0;o<e;o++)n[i][o]=i>o?t[i][o]:i===o?1:0;return n}get upperTriangularMatrix(){for(var t=this.LU,r=t.rows,e=t.columns,n=new P(r,e),i=0;i<r;i++)for(var o=0;o<e;o++)n[i][o]=i<=o?t[i][o]:0;return n}get pivotPermutationVector(){return this.pivotVector.slice()}}function l(t,r){var e=0;return Math.abs(t)>Math.abs(r)?(e=r/t,Math.abs(t)*Math.sqrt(1+e*e)):0!==r?(e=t/r,Math.abs(r)*Math.sqrt(1+e*e)):0}function c(t,r,e){for(var n=new Array(t),i=0;i<t;i++){n[i]=new Array(r);for(var o=0;o<r;o++)n[i][o]=e}return n}class f{constructor(t,r={}){var e=(t=j.checkMatrix(t)).rows,n=t.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:o=!0,autoTranspose:s=!1}=r;var a,h=Boolean(i),u=Boolean(o),f=!1;if(e<n)if(s){e=(a=t.transpose()).rows,n=a.columns,f=!0;var m=h;h=u,u=m}else a=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=t.clone();var g=Math.min(e,n),p=Math.min(e+1,n),v=new Array(p),d=c(e,g,0),w=c(n,n,0),y=new Array(n),b=new Array(e),x=new Array(p);for(let t=0;t<p;t++)x[t]=t;var M=Math.min(e-1,n),S=Math.max(0,Math.min(n-2,e)),E=Math.max(M,S);for(let t=0;t<E;t++){if(t<M){v[t]=0;for(let r=t;r<e;r++)v[t]=l(v[t],a[r][t]);if(0!==v[t]){a[t][t]<0&&(v[t]=-v[t]);for(let r=t;r<e;r++)a[r][t]/=v[t];a[t][t]+=1}v[t]=-v[t]}for(let r=t+1;r<n;r++){if(t<M&&0!==v[t]){let n=0;for(let i=t;i<e;i++)n+=a[i][t]*a[i][r];n=-n/a[t][t];for(let i=t;i<e;i++)a[i][r]+=n*a[i][t]}y[r]=a[t][r]}if(h&&t<M)for(let r=t;r<e;r++)d[r][t]=a[r][t];if(t<S){y[t]=0;for(let r=t+1;r<n;r++)y[t]=l(y[t],y[r]);if(0!==y[t]){y[t+1]<0&&(y[t]=0-y[t]);for(let r=t+1;r<n;r++)y[r]/=y[t];y[t+1]+=1}if(y[t]=-y[t],t+1<e&&0!==y[t]){for(let r=t+1;r<e;r++)b[r]=0;for(let r=t+1;r<e;r++)for(let e=t+1;e<n;e++)b[r]+=y[e]*a[r][e];for(let r=t+1;r<n;r++){let n=-y[r]/y[t+1];for(let i=t+1;i<e;i++)a[i][r]+=n*b[i]}}if(u)for(let r=t+1;r<n;r++)w[r][t]=y[r]}}let R=Math.min(n,e+1);if(M<n&&(v[M]=a[M][M]),e<R&&(v[R-1]=0),S+1<R&&(y[S]=a[S][R-1]),y[R-1]=0,h){for(let t=M;t<g;t++){for(let r=0;r<e;r++)d[r][t]=0;d[t][t]=1}for(let t=M-1;t>=0;t--)if(0!==v[t]){for(let r=t+1;r<g;r++){let n=0;for(let i=t;i<e;i++)n+=d[i][t]*d[i][r];n=-n/d[t][t];for(let i=t;i<e;i++)d[i][r]+=n*d[i][t]}for(let r=t;r<e;r++)d[r][t]=-d[r][t];d[t][t]=1+d[t][t];for(let r=0;r<t-1;r++)d[r][t]=0}else{for(let r=0;r<e;r++)d[r][t]=0;d[t][t]=1}}if(u)for(let t=n-1;t>=0;t--){if(t<S&&0!==y[t])for(let r=t+1;r<n;r++){let e=0;for(let i=t+1;i<n;i++)e+=w[i][t]*w[i][r];e=-e/w[t+1][t];for(let i=t+1;i<n;i++)w[i][r]+=e*w[i][t]}for(let r=0;r<n;r++)w[r][t]=0;w[t][t]=1}for(var z=R-1,k=Number.EPSILON;R>0;){let t,r;for(t=R-2;t>=-1&&-1!==t;t--){const r=Number.MIN_VALUE+k*Math.abs(v[t]+Math.abs(v[t+1]));if(Math.abs(y[t])<=r||Number.isNaN(y[t])){y[t]=0;break}}if(t===R-2)r=4;else{let e;for(e=R-1;e>=t&&e!==t;e--){let r=(e!==R?Math.abs(y[e]):0)+(e!==t+1?Math.abs(y[e-1]):0);if(Math.abs(v[e])<=k*r){v[e]=0;break}}e===t?r=3:e===R-1?r=1:(r=2,t=e)}switch(t++,r){case 1:{let r=y[R-2];y[R-2]=0;for(let e=R-2;e>=t;e--){let i=l(v[e],r),o=v[e]/i,s=r/i;if(v[e]=i,e!==t&&(r=-s*y[e-1],y[e-1]=o*y[e-1]),u)for(let t=0;t<n;t++)i=o*w[t][e]+s*w[t][R-1],w[t][R-1]=-s*w[t][e]+o*w[t][R-1],w[t][e]=i}break}case 2:{let r=y[t-1];y[t-1]=0;for(let n=t;n<R;n++){let i=l(v[n],r),o=v[n]/i,s=r/i;if(v[n]=i,r=-s*y[n],y[n]=o*y[n],h)for(let r=0;r<e;r++)i=o*d[r][n]+s*d[r][t-1],d[r][t-1]=-s*d[r][n]+o*d[r][t-1],d[r][n]=i}break}case 3:{const r=Math.max(Math.abs(v[R-1]),Math.abs(v[R-2]),Math.abs(y[R-2]),Math.abs(v[t]),Math.abs(y[t])),i=v[R-1]/r,o=v[R-2]/r,s=y[R-2]/r,a=v[t]/r,c=y[t]/r,f=((o+i)*(o-i)+s*s)/2,m=i*s*(i*s);let g=0;0===f&&0===m||(g=m/(f+(g=f<0?0-Math.sqrt(f*f+m):Math.sqrt(f*f+m))));let p=(a+i)*(a-i)+g,b=a*c;for(let r=t;r<R-1;r++){let i=l(p,b);0===i&&(i=Number.MIN_VALUE);let o=p/i,s=b/i;if(r!==t&&(y[r-1]=i),p=o*v[r]+s*y[r],y[r]=o*y[r]-s*v[r],b=s*v[r+1],v[r+1]=o*v[r+1],u)for(let t=0;t<n;t++)i=o*w[t][r]+s*w[t][r+1],w[t][r+1]=-s*w[t][r]+o*w[t][r+1],w[t][r]=i;if(0===(i=l(p,b))&&(i=Number.MIN_VALUE),o=p/i,s=b/i,v[r]=i,p=o*y[r]+s*v[r+1],v[r+1]=-s*y[r]+o*v[r+1],b=s*y[r+1],y[r+1]=o*y[r+1],h&&r<e-1)for(let t=0;t<e;t++)i=o*d[t][r]+s*d[t][r+1],d[t][r+1]=-s*d[t][r]+o*d[t][r+1],d[t][r]=i}y[R-2]=p,1;break}case 4:if(v[t]<=0&&(v[t]=v[t]<0?-v[t]:0,u))for(let r=0;r<=z;r++)w[r][t]=-w[r][t];for(;t<z&&!(v[t]>=v[t+1]);){let r=v[t];if(v[t]=v[t+1],v[t+1]=r,u&&t<n-1)for(let e=0;e<n;e++)r=w[e][t+1],w[e][t+1]=w[e][t],w[e][t]=r;if(h&&t<e-1)for(let n=0;n<e;n++)r=d[n][t+1],d[n][t+1]=d[n][t],d[n][t]=r;t++}0,R--}}if(f){var N=w;w=d,d=N}this.m=e,this.n=n,this.s=v,this.U=d,this.V=w}solve(t){var r=t,e=this.threshold,n=this.s.length,i=P.zeros(n,n);for(let t=0;t<n;t++)Math.abs(this.s[t])<=e?i[t][t]=0:i[t][t]=1/this.s[t];var o=this.U,s=this.rightSingularVectors,a=s.mmul(i),h=s.rows,u=o.length,l=P.zeros(h,u);for(let t=0;t<h;t++)for(let r=0;r<u;r++){let e=0;for(let i=0;i<n;i++)e+=a[t][i]*o[r][i];l[t][r]=e}return l.mmul(r)}solveForDiagonal(t){return this.solve(P.diag(t))}inverse(){var t=this.V,r=this.threshold,e=t.length,n=t[0].length,i=new P(e,this.s.length);for(let o=0;o<e;o++)for(let e=0;e<n;e++)Math.abs(this.s[e])>r?i[o][e]=t[o][e]/this.s[e]:i[o][e]=0;var o=this.U,s=o.length,a=o[0].length,h=new P(e,s);for(let t=0;t<e;t++)for(let r=0;r<s;r++){let e=0;for(let n=0;n<a;n++)e+=i[t][n]*o[r][n];h[t][r]=e}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){for(var t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,e=this.s,n=0,i=e.length;n<i;n++)e[n]>t&&r++;return r}get diagonal(){return this.s}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return P.isMatrix(this.U)||(this.U=new P(this.U)),this.U}get rightSingularVectors(){return P.isMatrix(this.V)||(this.V=new P(this.V)),this.V}get diagonalMatrix(){return P.diag(this.s)}}function m(t,r,e){var n=e?t.rows:t.rows-1;if(r<0||r>n)throw new RangeError("Row index out of range")}function g(t,r,e){var n=e?t.columns:t.columns-1;if(r<0||r>n)throw new RangeError("Column index out of range")}function p(t,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function v(t,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function d(t,r,e){return{row:w(t,r),column:y(t,e)}}function w(t,r){if("object"!=typeof r)throw new TypeError("unexpected type for row indices");if(r.some(r=>r<0||r>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(r)||(r=Array.from(r)),r}function y(t,r){if("object"!=typeof r)throw new TypeError("unexpected type for column indices");if(r.some(r=>r<0||r>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(r)||(r=Array.from(r)),r}function b(t,r,e,n,i){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(x("startRow",r),x("endRow",e),x("startColumn",n),x("endColumn",i),r>e||n>i||r<0||r>=t.rows||e<0||e>=t.rows||n<0||n>=t.columns||i<0||i>=t.columns)throw new RangeError("Submatrix indices are out of range")}function x(t,r){if("number"!=typeof r)throw new TypeError(`${t} must be a number`)}class M extends(I()){constructor(t,r,e){super(),this.matrix=t,this.rows=r,this.columns=e}static get[Symbol.species](){return P}}class S extends M{constructor(t){super(t,t.columns,t.rows)}set(t,r,e){return this.matrix.set(r,t,e),this}get(t,r){return this.matrix.get(r,t)}}class E extends M{constructor(t,r){super(t,1,t.columns),this.row=r}set(t,r,e){return this.matrix.set(this.row,r,e),this}get(t,r){return this.matrix.get(this.row,r)}}class R extends M{constructor(t,r,e,n,i){b(t,r,e,n,i),super(t,e-r+1,i-n+1),this.startRow=r,this.startColumn=n}set(t,r,e){return this.matrix.set(this.startRow+t,this.startColumn+r,e),this}get(t,r){return this.matrix.get(this.startRow+t,this.startColumn+r)}}class z extends M{constructor(t,r,e){var n=d(t,r,e);super(t,n.row.length,n.column.length),this.rowIndices=n.row,this.columnIndices=n.column}set(t,r,e){return this.matrix.set(this.rowIndices[t],this.columnIndices[r],e),this}get(t,r){return this.matrix.get(this.rowIndices[t],this.columnIndices[r])}}class k extends M{constructor(t,r){super(t,(r=w(t,r)).length,t.columns),this.rowIndices=r}set(t,r,e){return this.matrix.set(this.rowIndices[t],r,e),this}get(t,r){return this.matrix.get(this.rowIndices[t],r)}}class N extends M{constructor(t,r){r=y(t,r),super(t,t.rows,r.length),this.columnIndices=r}set(t,r,e){return this.matrix.set(t,this.columnIndices[r],e),this}get(t,r){return this.matrix.get(t,this.columnIndices[r])}}class A extends M{constructor(t,r){super(t,t.rows,1),this.column=r}set(t,r,e){return this.matrix.set(t,this.column,e),this}get(t){return this.matrix.get(t,this.column)}}class C extends M{constructor(t){super(t,t.rows,t.columns)}set(t,r,e){return this.matrix.set(this.rows-t-1,r,e),this}get(t,r){return this.matrix.get(this.rows-t-1,r)}}class V extends M{constructor(t){super(t,t.rows,t.columns)}set(t,r,e){return this.matrix.set(t,this.columns-r-1,e),this}get(t,r){return this.matrix.get(t,this.columns-r-1)}}function I(t){void 0===t&&(t=Object);class r extends t{static get[Symbol.species](){return this}static from1DArray(t,r,e){if(t*r!==e.length)throw new RangeError("Data length does not match given dimensions");for(var n=new this(t,r),i=0;i<t;i++)for(var o=0;o<r;o++)n.set(i,o,e[i*r+o]);return n}static rowVector(t){for(var r=new this(1,t.length),e=0;e<t.length;e++)r.set(0,e,t[e]);return r}static columnVector(t){for(var r=new this(t.length,1),e=0;e<t.length;e++)r.set(e,0,t[e]);return r}static empty(t,r){return new this(t,r)}static zeros(t,r){return this.empty(t,r).fill(0)}static ones(t,r){return this.empty(t,r).fill(1)}static rand(t,r,e){void 0===e&&(e=Math.random);for(var n=this.empty(t,r),i=0;i<t;i++)for(var o=0;o<r;o++)n.set(i,o,e());return n}static randInt(t,r,e,n){void 0===e&&(e=1e3),void 0===n&&(n=Math.random);for(var i=this.empty(t,r),o=0;o<t;o++)for(var s=0;s<r;s++){var a=Math.floor(n()*e);i.set(o,s,a)}return i}static eye(t,r,e){void 0===r&&(r=t),void 0===e&&(e=1);for(var n=Math.min(t,r),i=this.zeros(t,r),o=0;o<n;o++)i.set(o,o,e);return i}static diag(t,r,e){var n=t.length;void 0===r&&(r=n),void 0===e&&(e=r);for(var i=Math.min(n,r,e),o=this.zeros(r,e),s=0;s<i;s++)o.set(s,s,t[s]);return o}static min(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);for(var e=t.rows,n=t.columns,i=new this(e,n),o=0;o<e;o++)for(var s=0;s<n;s++)i.set(o,s,Math.min(t.get(o,s),r.get(o,s)));return i}static max(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);for(var e=t.rows,n=t.columns,i=new this(e,n),o=0;o<e;o++)for(var s=0;s<n;s++)i.set(o,s,Math.max(t.get(o,s),r.get(o,s)));return i}static checkMatrix(t){return r.isMatrix(t)?t:new this(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(var r=this.rows,e=this.columns,n=0;n<r;n++)for(var i=0;i<e;i++)t.call(this,n,i);return this}to1DArray(){for(var t=new Array(this.size),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t[r*this.columns+e]=this.get(r,e);return t}to2DArray(){for(var t=new Array(this.rows),r=0;r<this.rows;r++){t[r]=new Array(this.columns);for(var e=0;e<this.columns;e++)t[r][e]=this.get(r,e)}return t}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(var t=0;t<this.rows;t++)for(var r=0;r<=t;r++)if(this.get(t,r)!==this.get(r,t))return!1;return!0}return!1}isEchelonForm(){let t=0,r=0,e=-1,n=!0,i=!1;for(;t<this.rows&&n;){for(r=0,i=!1;r<this.columns&&!1===i;)0===this.get(t,r)?r++:1===this.get(t,r)&&r>e?(i=!0,e=r):(n=!1,i=!0);t++}return n}isReducedEchelonForm(){let t=0,r=0,e=-1,n=!0,i=!1;for(;t<this.rows&&n;){for(r=0,i=!1;r<this.columns&&!1===i;)0===this.get(t,r)?r++:1===this.get(t,r)&&r>e?(i=!0,e=r):(n=!1,i=!0);for(let e=r+1;e<this.rows;e++)0!==this.get(t,e)&&(n=!1);t++}return n}set(t,r,e){throw new Error("set method is unimplemented")}get(t,r){throw new Error("get method is unimplemented")}repeat(t,r){t=t||1,r=r||1;for(var e=new this.constructor[Symbol.species](this.rows*t,this.columns*r),n=0;n<t;n++)for(var i=0;i<r;i++)e.setSubMatrix(this,this.rows*n,this.columns*i);return e}fill(t){for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,t);return this}neg(){return this.mulS(-1)}getRow(t){m(this,t);for(var r=new Array(this.columns),e=0;e<this.columns;e++)r[e]=this.get(t,e);return r}getRowVector(t){return this.constructor.rowVector(this.getRow(t))}setRow(t,r){m(this,t),r=p(this,r);for(var e=0;e<this.columns;e++)this.set(t,e,r[e]);return this}swapRows(t,r){m(this,t),m(this,r);for(var e=0;e<this.columns;e++){var n=this.get(t,e);this.set(t,e,this.get(r,e)),this.set(r,e,n)}return this}getColumn(t){g(this,t);for(var r=new Array(this.rows),e=0;e<this.rows;e++)r[e]=this.get(e,t);return r}getColumnVector(t){return this.constructor.columnVector(this.getColumn(t))}setColumn(t,r){g(this,t),r=v(this,r);for(var e=0;e<this.rows;e++)this.set(e,t,r[e]);return this}swapColumns(t,r){g(this,t),g(this,r);for(var e=0;e<this.rows;e++){var n=this.get(e,t);this.set(e,t,this.get(e,r)),this.set(e,r,n)}return this}addRowVector(t){t=p(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)+t[e]);return this}subRowVector(t){t=p(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)-t[e]);return this}mulRowVector(t){t=p(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)*t[e]);return this}divRowVector(t){t=p(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)/t[e]);return this}addColumnVector(t){t=v(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)+t[r]);return this}subColumnVector(t){t=v(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)-t[r]);return this}mulColumnVector(t){t=v(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)*t[r]);return this}divColumnVector(t){t=v(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)/t[r]);return this}mulRow(t,r){m(this,t);for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)*r);return this}mulColumn(t,r){g(this,t);for(var e=0;e<this.rows;e++)this.set(e,t,this.get(e,t)*r);return this}max(){for(var t=this.get(0,0),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.get(r,e)>t&&(t=this.get(r,e));return t}maxIndex(){for(var t=this.get(0,0),r=[0,0],e=0;e<this.rows;e++)for(var n=0;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n),r[0]=e,r[1]=n);return r}min(){for(var t=this.get(0,0),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.get(r,e)<t&&(t=this.get(r,e));return t}minIndex(){for(var t=this.get(0,0),r=[0,0],e=0;e<this.rows;e++)for(var n=0;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n),r[0]=e,r[1]=n);return r}maxRow(t){m(this,t);for(var r=this.get(t,0),e=1;e<this.columns;e++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxRowIndex(t){m(this,t);for(var r=this.get(t,0),e=[t,0],n=1;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n),e[1]=n);return e}minRow(t){m(this,t);for(var r=this.get(t,0),e=1;e<this.columns;e++)this.get(t,e)<r&&(r=this.get(t,e));return r}minRowIndex(t){m(this,t);for(var r=this.get(t,0),e=[t,0],n=1;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n),e[1]=n);return e}maxColumn(t){g(this,t);for(var r=this.get(0,t),e=1;e<this.rows;e++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxColumnIndex(t){g(this,t);for(var r=this.get(0,t),e=[0,t],n=1;n<this.rows;n++)this.get(n,t)>r&&(r=this.get(n,t),e[0]=n);return e}minColumn(t){g(this,t);for(var r=this.get(0,t),e=1;e<this.rows;e++)this.get(e,t)<r&&(r=this.get(e,t));return r}minColumnIndex(t){g(this,t);for(var r=this.get(0,t),e=[0,t],n=1;n<this.rows;n++)this.get(n,t)<r&&(r=this.get(n,t),e[0]=n);return e}diag(){for(var t=Math.min(this.rows,this.columns),r=new Array(t),e=0;e<t;e++)r[e]=this.get(e,e);return r}sum(t){switch(t){case"row":return function(t){for(var r=P.zeros(t.rows,1),e=0;e<t.rows;++e)for(var n=0;n<t.columns;++n)r.set(e,0,r.get(e,0)+t.get(e,n));return r}(this);case"column":return function(t){for(var r=P.zeros(1,t.columns),e=0;e<t.rows;++e)for(var n=0;n<t.columns;++n)r.set(0,n,r.get(0,n)+t.get(e,n));return r}(this);default:return function(t){for(var r=0,e=0;e<t.rows;e++)for(var n=0;n<t.columns;n++)r+=t.get(e,n);return r}(this)}}mean(){return this.sum()/this.size}prod(){for(var t=1,r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t*=this.get(r,e);return t}norm(t="frobenius"){var r=0;if("max"===t)return this.max();if("frobenius"===t){for(var e=0;e<this.rows;e++)for(var n=0;n<this.columns;n++)r+=this.get(e,n)*this.get(e,n);return Math.sqrt(r)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){for(var t=0,r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t+=this.get(r,e),this.set(r,e,t);return this}dot(t){r.isMatrix(t)&&(t=t.to1DArray());var e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");for(var n=0,i=0;i<e.length;i++)n+=e[i]*t[i];return n}mmul(t){t=this.constructor.checkMatrix(t),this.columns!==t.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");for(var r=this.rows,e=this.columns,n=t.columns,i=new this.constructor[Symbol.species](r,n),o=new Array(e),s=0;s<n;s++){for(var a=0;a<e;a++)o[a]=t.get(a,s);for(var h=0;h<r;h++){var u=0;for(a=0;a<e;a++)u+=this.get(h,a)*o[a];i.set(h,s,u)}}return i}strassen2x2(t){var r=new this.constructor[Symbol.species](2,2);const e=this.get(0,0),n=t.get(0,0),i=this.get(0,1),o=t.get(0,1),s=this.get(1,0),a=t.get(1,0),h=this.get(1,1),u=t.get(1,1),l=(e+h)*(n+u),c=(s+h)*n,f=e*(o-u),m=h*(a-n),g=(e+i)*u,p=l+m-g+(i-h)*(a+u),v=f+g,d=c+m,w=l-c+f+(s-e)*(n+o);return r.set(0,0,p),r.set(0,1,v),r.set(1,0,d),r.set(1,1,w),r}strassen3x3(t){var r=new this.constructor[Symbol.species](3,3);const e=this.get(0,0),n=this.get(0,1),i=this.get(0,2),o=this.get(1,0),s=this.get(1,1),a=this.get(1,2),h=this.get(2,0),u=this.get(2,1),l=this.get(2,2),c=t.get(0,0),f=t.get(0,1),m=t.get(0,2),g=t.get(1,0),p=t.get(1,1),v=t.get(1,2),d=t.get(2,0),w=t.get(2,1),y=t.get(2,2),b=(e-o)*(-f+p),x=(-e+o+s)*(c-f+p),M=(o+s)*(-c+f),S=e*c,E=(-e+h+u)*(c-m+v),R=(-e+h)*(m-v),z=(h+u)*(-c+m),k=(-i+u+l)*(p+d-w),N=(i-l)*(p-w),A=i*d,C=(u+l)*(-d+w),V=(-i+s+a)*(v+d-y),I=(i-a)*(v-y),P=(s+a)*(-d+y),j=S+A+n*g,_=(e+n+i-o-s-u-l)*p+x+M+S+k+A+C,F=S+E+z+(e+n+i-s-a-h-u)*v+A+V+P,O=b+s*(-c+f+g-p-v-d+y)+x+S+A+V+I,D=b+x+M+S+a*w,T=A+V+I+P+o*m,L=S+E+R+u*(-c+m+g-p-v-d+w)+k+N+A,q=k+N+A+C+h*f,U=S+E+R+z+l*y;return r.set(0,0,j),r.set(0,1,_),r.set(0,2,F),r.set(1,0,O),r.set(1,1,D),r.set(1,2,T),r.set(2,0,L),r.set(2,1,q),r.set(2,2,U),r}mmulStrassen(t){var e=this.clone(),n=e.rows,i=e.columns,o=t.rows,s=t.columns;function a(t,e,n){var i=t.rows,o=t.columns;if(i===e&&o===n)return t;var s=r.zeros(e,n);return s=s.setSubMatrix(t,0,0)}i!==o&&console.warn(`Multiplying ${n} x ${i} and ${o} x ${s} matrix: dimensions do not match.`);var h=Math.max(n,o),u=Math.max(i,s);return function t(e,n,i,o){if(i<=512||o<=512)return e.mmul(n);i%2==1&&o%2==1?(e=a(e,i+1,o+1),n=a(n,i+1,o+1)):i%2==1?(e=a(e,i+1,o),n=a(n,i+1,o)):o%2==1&&(e=a(e,i,o+1),n=a(n,i,o+1));var s=parseInt(e.rows/2,10),h=parseInt(e.columns/2,10),u=e.subMatrix(0,s-1,0,h-1),l=n.subMatrix(0,s-1,0,h-1),c=e.subMatrix(0,s-1,h,e.columns-1),f=n.subMatrix(0,s-1,h,n.columns-1),m=e.subMatrix(s,e.rows-1,0,h-1),g=n.subMatrix(s,n.rows-1,0,h-1),p=e.subMatrix(s,e.rows-1,h,e.columns-1),v=n.subMatrix(s,n.rows-1,h,n.columns-1),d=t(r.add(u,p),r.add(l,v),s,h),w=t(r.add(m,p),l,s,h),y=t(u,r.sub(f,v),s,h),b=t(p,r.sub(g,l),s,h),x=t(r.add(u,c),v,s,h),M=t(r.sub(m,u),r.add(l,f),s,h),S=t(r.sub(c,p),r.add(g,v),s,h),E=r.add(d,b);E.sub(x),E.add(S);var R=r.add(y,x),z=r.add(w,b),k=r.sub(d,w);k.add(y),k.add(M);var N=r.zeros(2*E.rows,2*E.columns);return(N=(N=(N=(N=N.setSubMatrix(E,0,0)).setSubMatrix(R,E.rows,0)).setSubMatrix(z,0,E.columns)).setSubMatrix(k,E.rows,E.columns)).subMatrix(0,i-1,0,o-1)}(e=a(e,h,u),t=a(t,h,u),h,u)}scaleRows(t,r){if((t=void 0===t?0:t)>=(r=void 0===r?1:r))throw new RangeError("min should be strictly smaller than max");for(var e=this.constructor.empty(this.rows,this.columns),n=0;n<this.rows;n++){var i=h(this.getRow(n),{min:t,max:r});e.setRow(n,i)}return e}scaleColumns(t,r){if((t=void 0===t?0:t)>=(r=void 0===r?1:r))throw new RangeError("min should be strictly smaller than max");for(var e=this.constructor.empty(this.rows,this.columns),n=0;n<this.columns;n++){var i=h(this.getColumn(n),{min:t,max:r});e.setColumn(n,i)}return e}kroneckerProduct(t){t=this.constructor.checkMatrix(t);for(var r=this.rows,e=this.columns,n=t.rows,i=t.columns,o=new this.constructor[Symbol.species](r*n,e*i),s=0;s<r;s++)for(var a=0;a<e;a++)for(var h=0;h<n;h++)for(var u=0;u<i;u++)o[n*s+h][i*a+u]=this.get(s,a)*t.get(h,u);return o}transpose(){for(var t=new this.constructor[Symbol.species](this.columns,this.rows),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t.set(e,r,this.get(r,e));return t}sortRows(t){void 0===t&&(t=e);for(var r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(t));return this}sortColumns(t){void 0===t&&(t=e);for(var r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(t));return this}subMatrix(t,r,e,n){b(this,t,r,e,n);for(var i=new this.constructor[Symbol.species](r-t+1,n-e+1),o=t;o<=r;o++)for(var s=e;s<=n;s++)i[o-t][s-e]=this.get(o,s);return i}subMatrixRow(t,r,e){if(void 0===r&&(r=0),void 0===e&&(e=this.columns-1),r>e||r<0||r>=this.columns||e<0||e>=this.columns)throw new RangeError("Argument out of range");for(var n=new this.constructor[Symbol.species](t.length,e-r+1),i=0;i<t.length;i++)for(var o=r;o<=e;o++){if(t[i]<0||t[i]>=this.rows)throw new RangeError(`Row index out of range: ${t[i]}`);n.set(i,o-r,this.get(t[i],o))}return n}subMatrixColumn(t,r,e){if(void 0===r&&(r=0),void 0===e&&(e=this.rows-1),r>e||r<0||r>=this.rows||e<0||e>=this.rows)throw new RangeError("Argument out of range");for(var n=new this.constructor[Symbol.species](e-r+1,t.length),i=0;i<t.length;i++)for(var o=r;o<=e;o++){if(t[i]<0||t[i]>=this.columns)throw new RangeError(`Column index out of range: ${t[i]}`);n.set(o-r,i,this.get(o,t[i]))}return n}setSubMatrix(t,r,e){b(this,r,r+(t=this.constructor.checkMatrix(t)).rows-1,e,e+t.columns-1);for(var n=0;n<t.rows;n++)for(var i=0;i<t.columns;i++)this[r+n][e+i]=t.get(n,i);return this}selection(t,r){for(var e=d(this,t,r),n=new this.constructor[Symbol.species](t.length,r.length),i=0;i<e.row.length;i++)for(var o=e.row[i],s=0;s<e.column.length;s++){var a=e.column[s];n[i][s]=this.get(o,a)}return n}trace(){for(var t=Math.min(this.rows,this.columns),r=0,e=0;e<t;e++)r+=this.get(e,e);return r}transposeView(){return new S(this)}rowView(t){return m(this,t),new E(this,t)}columnView(t){return g(this,t),new A(this,t)}flipRowView(){return new C(this)}flipColumnView(){return new V(this)}subMatrixView(t,r,e,n){return new R(this,t,r,e,n)}selectionView(t,r){return new z(this,t,r)}rowSelectionView(t){return new k(this,t)}columnSelectionView(t){return new N(this,t)}det(){var t,r,e,n,i,o;if(this.isSquare())return 2===this.columns?(t=this.get(0,0),r=this.get(0,1),e=this.get(1,0),t*this.get(1,1)-r*e):3===this.columns?(n=this.selectionView([1,2],[1,2]),i=this.selectionView([1,2],[0,2]),o=this.selectionView([1,2],[0,1]),t=this.get(0,0),r=this.get(0,1),e=this.get(0,2),t*n.det()-r*i.det()+e*o.det()):new u(this).determinant;throw Error("Determinant can only be calculated for a square matrix.")}pseudoInverse(t){void 0===t&&(t=Number.EPSILON);for(var r=new f(this,{autoTranspose:!0}),e=r.leftSingularVectors,n=r.rightSingularVectors,i=r.diagonal,o=0;o<i.length;o++)Math.abs(i[o])>t?i[o]=1/i[o]:i[o]=0;return i=this.constructor[Symbol.species].diag(i),n.mmul(i.mmul(e.transposeView()))}clone(){for(var t=new this.constructor[Symbol.species](this.rows,this.columns),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t.set(r,e,this.get(r,e));return t}}function e(t,r){return t-r}r.prototype.klass="Matrix",r.random=r.rand,r.diagonal=r.diag,r.prototype.diagonal=r.prototype.diag,r.identity=r.eye,r.prototype.negate=r.prototype.neg,r.prototype.tensorProduct=r.prototype.kroneckerProduct,r.prototype.determinant=r.prototype.det;var n,i="\n(function %name%(matrix, %args%) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(%args%);\n})\n",o=eval;for(var s of[["+","add"],["-","sub","subtract"],["*","mul","multiply"],["/","div","divide"],["%","mod","modulus"],["&","and"],["|","or"],["^","xor"],["<<","leftShift"],[">>","signPropagatingRightShift"],[">>>","rightShift","zeroFillRightShift"]]){var a=o($("\n(function %name%(value) {\n    if (typeof value === 'number') return this.%name%S(value);\n    return this.%name%M(value);\n})\n",{name:s[1],op:s[0]})),l=o($("\n(function %name%S(value) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, this.get(i, j) %op% value);\n        }\n    }\n    return this;\n})\n",{name:`${s[1]}S`,op:s[0]})),c=o($("\n(function %name%M(matrix) {\n    matrix = this.constructor.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n        this.columns !== matrix.columns) {\n        throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));\n        }\n    }\n    return this;\n})\n",{name:`${s[1]}M`,op:s[0]})),w=o($("\n(function %name%(matrix, value) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(value);\n})\n",{name:s[1]}));for(n=1;n<s.length;n++)r.prototype[s[n]]=a,r.prototype[`${s[n]}S`]=l,r.prototype[`${s[n]}M`]=c,r[s[n]]=w}var y=[["~","not"]];for(var x of(["abs","acos","acosh","asin","asinh","atan","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","log","log1p","log10","log2","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].forEach(function(t){y.push([`Math.${t}`,t])}),y)){var M=o($("\n(function %name%() {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j)));\n        }\n    }\n    return this;\n})\n",{name:x[1],method:x[0]})),I=o($("\n(function %name%(matrix) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%();\n})\n",{name:x[1]}));for(n=1;n<x.length;n++)r.prototype[x[n]]=M,r[x[n]]=I}for(var j of[["Math.pow",1,"pow"]]){var _="arg0";for(n=1;n<j[1];n++)_+=`, arg${n}`;if(1!==j[1]){var F=o($("\n(function %name%(%args%) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), %args%));\n        }\n    }\n    return this;\n})\n",{name:j[2],method:j[0],args:_})),O=o($(i,{name:j[2],args:_}));for(n=2;n<j.length;n++)r.prototype[j[n]]=F,r[j[n]]=O}else{var D={name:j[2],args:_,method:j[0]},T=o($("\n(function %name%(value) {\n    if (typeof value === 'number') return this.%name%S(value);\n    return this.%name%M(value);\n})\n",D)),L=o($("\n(function %name%S(value) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), value));\n        }\n    }\n    return this;\n})\n",D)),q=o($("\n(function %name%M(matrix) {\n    matrix = this.constructor.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n        this.columns !== matrix.columns) {\n        throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));\n        }\n    }\n    return this;\n})\n",D)),U=o($("\n(function %name%(matrix, %args%) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(%args%);\n})\n",D));for(n=2;n<j.length;n++)r.prototype[j[n]]=T,r.prototype[`${j[n]}M`]=q,r.prototype[`${j[n]}S`]=L,r[j[n]]=U}}function $(t,r){for(var e in r)t=t.replace(new RegExp(`%${e}%`,"g"),r[e]);return t}return r}class P extends(I(Array)){constructor(t,r){var e;if(1===arguments.length&&"number"==typeof t)return new Array(t);if(P.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(super(t),!(Number.isInteger(r)&&r>0))throw new TypeError("nColumns must be a positive integer");for(e=0;e<t;e++)this[e]=new Array(r)}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const n=t;if(t=n.length,"number"!=typeof(r=n[0].length)||0===r)throw new TypeError("Data must be a 2D array with at least one element");for(super(t),e=0;e<t;e++){if(n[e].length!==r)throw new RangeError("Inconsistent array dimensions");this[e]=[].concat(n[e])}}}return this.rows=t,this.columns=r,this}set(t,r,e){return this[t][r]=e,this}get(t,r){return this[t][r]}removeRow(t){if(m(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.splice(t,1),this.rows-=1,this}addRow(t,r){return void 0===r&&(r=t,t=this.rows),m(this,t,!0),r=p(this,r),this.splice(t,0,r),this.rows+=1,this}removeColumn(t){if(g(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(var r=0;r<this.rows;r++)this[r].splice(t,1);return this.columns-=1,this}addColumn(t,r){void 0===r&&(r=t,t=this.columns),g(this,t,!0),r=v(this,r);for(var e=0;e<this.rows;e++)this[e].splice(t,0,r[e]);return this.columns+=1,this}}class j extends(I()){constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,r,e){return this.data[t][r]=e,this}get(t,r){return this.data[t][r]}static get[Symbol.species](){return P}}class _{constructor(t){var r,e,n,i,o=(t=j.checkMatrix(t)).clone(),s=t.rows,a=t.columns,h=new Array(a);for(n=0;n<a;n++){var u=0;for(r=n;r<s;r++)u=l(u,o.get(r,n));if(0!==u){for(o.get(n,n)<0&&(u=-u),r=n;r<s;r++)o.set(r,n,o.get(r,n)/u);for(o.set(n,n,o.get(n,n)+1),e=n+1;e<a;e++){for(i=0,r=n;r<s;r++)i+=o.get(r,n)*o.get(r,e);for(i=-i/o.get(n,n),r=n;r<s;r++)o.set(r,e,o.get(r,e)+i*o.get(r,n))}}h[n]=-u}this.QR=o,this.Rdiag=h}solve(t){t=P.checkMatrix(t);var r=this.QR,e=r.rows;if(t.rows!==e)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var n,i,o,s,a=t.columns,h=t.clone(),u=r.columns;for(o=0;o<u;o++)for(i=0;i<a;i++){for(s=0,n=o;n<e;n++)s+=r[n][o]*h[n][i];for(s=-s/r[o][o],n=o;n<e;n++)h[n][i]+=s*r[n][o]}for(o=u-1;o>=0;o--){for(i=0;i<a;i++)h[o][i]/=this.Rdiag[o];for(n=0;n<o;n++)for(i=0;i<a;i++)h[n][i]-=h[o][i]*r[n][o]}return h.subMatrix(0,u-1,0,a-1)}isFullRank(){for(var t=this.QR.columns,r=0;r<t;r++)if(0===this.Rdiag[r])return!1;return!0}get upperTriangularMatrix(){var t,r,e=this.QR,n=e.columns,i=new P(n,n);for(t=0;t<n;t++)for(r=0;r<n;r++)i[t][r]=t<r?e[t][r]:t===r?this.Rdiag[t]:0;return i}get orthogonalMatrix(){var t,r,e,n,i=this.QR,o=i.rows,s=i.columns,a=new P(o,s);for(e=s-1;e>=0;e--){for(t=0;t<o;t++)a[t][e]=0;for(a[e][e]=1,r=e;r<s;r++)if(0!==i[e][e]){for(n=0,t=e;t<o;t++)n+=i[t][e]*a[t][r];for(n=-n/i[e][e],t=e;t<o;t++)a[t][r]+=n*i[t][e]}}return a}}function F(t,r=!1){return t=j.checkMatrix(t),r?new f(t).inverse():function(t,r,e=!1){return t=j.checkMatrix(t),r=j.checkMatrix(r),e?new f(t).solve(r):t.isSquare()?new u(t).solve(r):new _(t).solve(r)}(t,P.eye(t.rows))}function O(t,r,e,n,i){var o=e*n*n,s=P.eye(r.length,r.length,o);const a=i(r);var h=t.x.map(t=>a(t)),u=function(t,r,e,n,i){const o=e.length,s=t.x.length;for(var a=new Array(o),h=0;h<o;h++){a[h]=new Array(s);var u=e.concat();u[h]+=n;for(var l=i(u),c=0;c<s;c++)a[h][c]=r[c]-l(t.x[c])}return new P(a)}(t,h,r,n,i),l=function(t,r){const e=t.x.length;for(var n=new Array(e),i=0;i<e;i++)n[i]=[t.y[i]-r[i]];return new P(n)}(t,h),c=F(s.add(u.mmul(u.transpose())));return(r=(r=new P([r])).sub(c.mmul(u).mmul(l).mul(n).transpose())).to1DArray()}function D(t,r,e={}){let{maxIterations:i=100,gradientDifference:o=.1,damping:s=0,errorTolerance:a=.01,minValues:h,maxValues:u,initialValues:l}=e;if(s<=0)throw new Error("The damping option must be a positive number");if(!t.x||!t.y)throw new Error("The data parameter must have x and y elements");if(!Array.isArray(t.x)||t.x.length<2||!Array.isArray(t.y)||t.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(t.x.length!==t.y.length)throw new Error("The data parameter elements must have the same size");var c=l||new Array(r.length).fill(1);let f=c.length;if(u=u||new Array(f).fill(Number.MAX_SAFE_INTEGER),h=h||new Array(f).fill(Number.MIN_SAFE_INTEGER),u.length!==h.length)throw new Error("minValues and maxValues must be the same size");if(!Array.isArray(c))throw new Error("initialValues must be an array");for(var m=n(t,c,r),g=m<=a,p=0;p<i&&!g;p++){c=O(t,c,s,o,r);for(let t=0;t<f;t++)c[t]=Math.min(Math.max(h[t],c[t]),u[t]);if(m=n(t,c,r),isNaN(m))break;g=m<=a}return{parameterValues:c,parameterError:m,iterations:p}}e.d(r,"default",function(){return D})}]);